/* Criando os gatilhos das tabelas de hist√≥rico */

CREATE TRIGGER TG_HIST_BANNER
BEFORE UPDATE ON BANNER
FOR EACH ROW

DECLARE
NOME_HIST VARCHAR2(255);
DATA_CADASTRO_HIST DATE;
DATA_EXPIRACAO_HIST DATE;
STATUS_DLT_HIST CHAR(1);
ID_RESP_FK_HIST INTEGER;
ALT BOOLEAN;
BEGIN
    ALT := FALSE;
    IF (:NEW.NOME != NULL) THEN
        NOME := :NEW.NOME;
        
    IF ELSE (:NEW.DATA_CADASTRO != NULL) THEN
        DATA_CADASTRO := :NEW.DATA_CADASTRO;
    
    IF ELSE (:NEW.DATA_EXPIRACAO != NULL) THEN
        DATA_EXPIRACAO := :NEW.DATA_EXPIRACAO;
        
    IF ELSE (:NEW.STATUS_DLT != NULL) THEN
        STATUS_DLT := :NEW.STATUS_DLT;
        
    IF ELSE (:NEW.ID_RESP_FK != NULL) THEN
        ID_RESP_FK := :NEW.ID_RESP_FK;
        
    IF ELSE (NOME_HIST IS NULL AND 
            DATA_CADASTRO_HIST IS NULL AND
            DATA_EXPIRACAO_HIST IS NULL AND
            STATUS_DLT_HIST IS NULL AND
            ID_RESP_FK_HIST IS NULL) THEN
            ALT := FALSE;
    ELSE;
    
    END IF;
    IF (ALT = TRUE) THEN
        INSERT INTO HIST_BANNER (ID,NOME,DATA_CADASTRO,DATA_EXPIRACAO,STATUS_DLT,ID_RESP_FK,ID_BAN_FK,DATA_HORA) VALUES
        (SQ_HIST_BANNER.nextval,NOME_HIST, DATA_CADASTRO_HIST, DATA_EXPIRACAO_HIST, STATUS_DLT_HIST, ID_RESP_FK_HIS,to_char(sysdate,'dd/mm/yyyy hh24:mi:ss'));
END;